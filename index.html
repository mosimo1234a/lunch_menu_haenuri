<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>í•´ëˆ„ë¦¬ ì´ˆë“±í•™êµ ìš°ë¦¬ë“¤ì˜ ê³µê°„ ğŸ€ (ìµœì¢… ê°„ì†Œí™”)</title>
<link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
<style>
    /* --- 1. CSS ë³€ìˆ˜ ë° ê¸°ë³¸ ì„¤ì • --- */
    :root {
        --color-apricot: #ffd9a8; --color-sky: #cceeff; --color-rose: #ffc9d4;
        --color-grass: #d2f6c9; --color-text-dark: #3a322b; 
        --color-card-bg: #ffffff; --color-border: #3a322b;
    }

    body {
        font-family: 'Jua', sans-serif;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        margin: 0;
        background-color: var(--color-apricot);
        color: var(--color-text-dark);
        background-image: url('data:image/svg+xml;utf8,<svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><circle cx="5" cy="5" r="1.5" fill="%23f6f0e9" opacity="0.8"/><path d="M15,15 L15,13 L15,11 L13,13 Z" fill="%23f6f0e9" opacity="0.6"/></svg>');
        background-size: 40px 40px;
    }

    /* --- 2. ì¹´ë“œ ë””ìì¸ --- */
    .card {
        background-color: var(--color-card-bg);
        border-radius: 35px;
        padding: 40px;
        border: 4px dashed var(--color-border);
        box-shadow: 6px 6px 0 0 var(--color-border); 
        text-align: center;
        width: 90%;
        max-width: 400px; 
        transform: rotate(-3deg);
        box-sizing: border-box;
    }
    
    p {
        font-size: 2rem;
        font-weight: bold;
        margin-bottom: 30px;
        line-height: 1.2;
    }
    
    .date-text {
        font-size: 1.2rem; 
        font-weight: 600;
        margin-bottom: 10px; 
        color: var(--color-text-dark); 
        transform: rotate(1deg);
    }

    /* --- 3. ë²„íŠ¼ ë””ìì¸ --- */
    button {
        font-family: 'Jua', sans-serif;
        font-weight: bold;
        font-size: 1.2rem;
        padding: 12px 25px;
        margin: 8px;
        border-radius: 30px;
        border: 4px solid var(--color-border); 
        color: var(--color-border);
        cursor: pointer;
        box-shadow: 4px 4px 0px 0px var(--color-border);
        transform: rotate(2deg);
        background-color: #fff;
    }
    
    /* í¬í„¸ ë²„íŠ¼ (ê¸‰ì‹ ë©”ë‰´ ë²„íŠ¼) */
    #lunch-menu { 
        background-color: var(--color-rose); 
        transform: rotate(-4deg);
        width: 100%; /* ë²„íŠ¼ì´ ì „ì²´ ë„ˆë¹„ë¥¼ ì°¨ì§€í•˜ë„ë¡ ì„¤ì • */
    }

    #yes_btn { background-color: var(--color-rose); transform: rotate(-4deg); }
    #no_btn { background-color: var(--color-grass); }
    #logout_btn, #back_btn { background-color: var(--color-sky); }
    
    /* --- 4. ë©”ì‹œì§€ ë° í‘œ ì˜ì—­ --- */
    .hidden { display: none; }
    .message {
        font-size: 1.6rem;
        font-weight: bold;
        margin-top: 20px;
        color: var(--color-text-dark);
    }

    /* --- 5. í‘œ (Table) ë””ìì¸ --- */
    #menu_table_area {
        margin-top: 20px;
        padding: 10px;
        border: 2px dashed var(--color-rose);
        border-radius: 15px;
        background-color: #fffbf5;
    }
    #menu_table_area h3 {
        font-size: 1.3rem;
        margin-top: 0;
        margin-bottom: 10px;
        color: var(--color-rose);
        transform: rotate(-1deg);
    }
    #menu_table {
        width: 100%;
        border-collapse: collapse;
        font-size: 1rem;
    }
    #menu_table th, #menu_table td {
        border: 2px solid var(--color-border);
        padding: 8px 5px;
        text-align: center;
        background-color: #ffffff;
    }
    #menu_table th {
        background-color: var(--color-sky);
        color: var(--color-border);
        font-size: 1.1rem;
    }
</style>
</head>
<body>
<div id="question" class="card">
    <p>í•´ëˆ„ë¦¬ ì´ˆë“±í•™êµ í•™ìƒì…ë‹ˆê¹Œ? ğŸ</p>
    <button id="yes_btn">ë„¤! ë§ìŠµë‹ˆë‹¤! ğŸ¥³</button>
    <button id="no_btn">ì•„ë‹™ë‹ˆë‹¤ ğŸ˜¥</button>
</div>

<div id="portal" class="card hidden">
    <p id="today-date-display" class="date-text"></p> 
    <p>ì˜¤ëŠ˜ì˜ ê¸‰ì‹ ë©”ë‰´ë¥¼ í™•ì¸í•©ë‹ˆë‹¤. ğŸš</p>
    <button id="lunch-menu">ê¸‰ì‹ ë©”ë‰´ ğŸš</button>
    </div>

<div id="message_area" class="card hidden">
    <p id="message_text" class="message hidden"></p> 
    
    <div id="menu_table_area" class="hidden">
        <h3>ì˜¤ëŠ˜ì˜ ê¸‰ì‹ ë©”ë‰´</h3>
        <table id="menu_table">
            </table>
    </div>

    <button id="back_btn">ì´ì „ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
</div>
<script>
// --- JavaScript ì‹œì‘ ---

const NEIS_CONFIG = {
    KEY: "59ff63a46d7f41bf97464e3caf3a486c", 
    ATPT_OFCDC_SC_CODE: "B10", 
    SD_SCHUL_CODE: "7130255", 
    URL: "https://open.neis.go.kr/hub/mealServiceDietInfo",
};

// --- API í˜¸ì¶œ í•¨ìˆ˜ (ë©”ë‰´ ë°°ì—´ ë°˜í™˜) ---
async function fetchMealDataFromAPI() {
    const today = new Date();
    const YYYYMMDD = `${today.getFullYear()}${String(today.getMonth() + 1).padStart(2, '0')}${String(today.getDate()).padStart(2, '0')}`;
    
    const apiUrl = `${NEIS_CONFIG.URL}?KEY=${NEIS_CONFIG.KEY}&Type=json&pIndex=1&pSize=100` +
                   `&ATPT_OFCDC_SC_CODE=${NEIS_CONFIG.ATPT_OFCDC_SC_CODE}` +
                   `&SD_SCHUL_CODE=${NEIS_CONFIG.SD_SCHUL_CODE}&MLSV_YMD=${YYYYMMDD}`; 
                   
    try {
        const response = await fetch(apiUrl);
        
        if (!response.ok) {
            return { error: `[ì—ëŸ¬] ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜: HTTP ${response.status}. (ì¸ì¦í‚¤, URL ë“±ë¡ í™•ì¸ í•„ìš”)` };
        }
        
        const data = await response.json();

        if (data.mealServiceDietInfo) {
            let menuString = data.mealServiceDietInfo[1].row[0].DDISH_NM;
            
            // ë©”ë‰´ ë¬¸ìì—´ì„ <br/> ê¸°ì¤€ìœ¼ë¡œ ë¶„ë¦¬í•˜ê³ , ê´„í˜¸ ì•ˆì˜ ì•Œë ˆë¥´ê¸° ì •ë³´ëŠ” ì œê±°
            let menuArray = menuString
                .split('<br/>')
                .map(item => item.replace(/\([0-9\.]+\)/g, '').trim())
                .filter(item => item.length > 0); 
                
            return { success: true, menu: menuArray };
        } else if (data.RESULT && data.RESULT.CODE === 'INFO-200') {
            return { error: `[ê³µì§€] ì˜¤ëŠ˜ ê¸‰ì‹ ì •ë³´ëŠ” ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ì£¼ë§ ë˜ëŠ” ë°©í•™) ğŸ˜¥` };
        } else if (data.RESULT && data.RESULT.MESSAGE) {
            return { error: `[NEIS ì—ëŸ¬] ${data.RESULT.MESSAGE}` };
        }
        else {
            return { error: `[ì—ëŸ¬] ì•Œ ìˆ˜ ì—†ëŠ” API ì‘ë‹µ í˜•ì‹ì…ë‹ˆë‹¤.` };
        }
    } catch (error) {
        console.error("Fetch ë˜ëŠ” JSON íŒŒì‹± ì˜¤ë¥˜:", error);
        return { error: `[ì—ëŸ¬] ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì¹˜ëª…ì ì¸ ì˜¤ë¥˜ ë°œìƒ: ${error.message}` }; 
    }
}

// --- í‘œ(Table)ë¥¼ ìƒì„±í•˜ì—¬ í‘œì‹œí•˜ëŠ” í•¨ìˆ˜ ---
function displayMenuAsTable(menuArray) {
    const tableBody = document.querySelector('#menu_table');
    tableBody.innerHTML = ''; // ê¸°ì¡´ ë‚´ìš© ì´ˆê¸°í™”

    // í—¤ë” ì¶”ê°€
    const headerRow = tableBody.insertRow();
    headerRow.innerHTML = '<th>No.</th><th>ë©”ë‰´</th>';

    // ë©”ë‰´ í•­ëª© ì¶”ê°€
    menuArray.forEach((item, index) => {
        const row = tableBody.insertRow();
        const cellNo = row.insertCell();
        const cellMenu = row.insertCell();
        cellNo.textContent = index + 1;
        cellMenu.textContent = item;
    });
}

// --- ì˜¤ëŠ˜ ë‚ ì§œë¥¼ ê°€ì ¸ì™€ HTMLì— í‘œì‹œí•˜ëŠ” í•¨ìˆ˜ ---
function displayTodayDate() {
    const today = new Date();
    const year = today.getFullYear();
    const month = today.getMonth() + 1; 
    const date = today.getDate();
    const day = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '][today.getDay()];
    
    const formattedDate = `${year}ë…„ ${String(month).padStart(2, '0')}ì›” ${String(date).padStart(2, '0')}ì¼ (${day})`;
    
    const dateElement = document.getElementById('today-date-display');
    if (dateElement) {
        dateElement.textContent = formattedDate;
    }
}


// --- UI ìš”ì†Œ ë° ìƒíƒœ ê´€ë¦¬ ë¡œì§ ---
const UI = {
    screens: { 
        question: document.getElementById("question"), 
        portal: document.getElementById("portal"), 
        message_area: document.getElementById("message_area") 
    }, 
    elements: { 
        body: document.body, 
        message_text: document.getElementById("message_text"), 
        back_btn: document.getElementById("back_btn"), 
        yes_btn: document.getElementById("yes_btn"), 
        no_btn: document.getElementById("no_btn"),
        lunch_menu_btn: document.getElementById("lunch-menu"),
        menu_table_area: document.getElementById("menu_table_area") 
    }
};


const StateManager = {
    showScreen: function(screenId, stateClass = '') {
        Object.values(UI.screens).forEach(el => el.classList.add("hidden"));
        UI.screens[screenId].classList.remove("hidden");
        UI.elements.body.classList.remove("access-state", "deny-state");
        if (stateClass) UI.elements.body.classList.add(stateClass);
    },
    
    // ê¸‰ì‹ ë©”ë‰´ í´ë¦­ ì‹œ ë¡œì§
    showMealMenu: async function(prevId, stateClass) {
        this.showScreen("message_area", stateClass);
        
        // í‘œ ì˜ì—­ ìˆ¨ê¸°ê³ , ë¡œë”© í…ìŠ¤íŠ¸ í‘œì‹œ
        UI.elements.menu_table_area.classList.add("hidden");
        UI.elements.message_text.classList.remove("hidden"); 
        UI.elements.message_text.textContent = "ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤... â³";
        
        const result = await fetchMealDataFromAPI();
        
        if (result.success) {
            // ì„±ê³µ ì‹œ: ë¡œë”© í…ìŠ¤íŠ¸ ìˆ¨ê¸°ê³ , í‘œ í‘œì‹œ
            displayMenuAsTable(result.menu);
            UI.elements.message_text.classList.add("hidden");
            UI.elements.menu_table_area.classList.remove("hidden");
        } else {
            // ì‹¤íŒ¨ ì‹œ: ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ, í‘œ ì˜ì—­ ìˆ¨ê¹€ ìœ ì§€
            UI.elements.message_text.textContent = result.error;
            UI.elements.menu_table_area.classList.add("hidden");
        }

        // ëŒì•„ê°€ê¸° ë²„íŠ¼ ì„¤ì •
        UI.elements.back_btn.onclick = () => this.showScreen(prevId, 'access-state');
    },
    
    // 'ì•„ë‹™ë‹ˆë‹¤' ë²„íŠ¼ í´ë¦­ ì‹œ ë¡œì§
    showDenyMessage: function() {
        this.showScreen("message_area", "deny-state");
        UI.elements.menu_table_area.classList.add("hidden");
        UI.elements.message_text.classList.remove("hidden");
        UI.elements.message_text.textContent = "ì•„ì§ í•´ëˆ„ë¦¬ ì¹œêµ¬ê°€ ì•„ë‹ˆêµ°ìš”! ë‹¤ìŒì— ê¼­ ë§Œë‚˜ìš”! ğŸ‘‹";
        
        // ëŒì•„ê°€ê¸° ë²„íŠ¼ ì„¤ì • (ì§ˆë¬¸ í™”ë©´ìœ¼ë¡œ ë³µê·€)
        UI.elements.back_btn.onclick = () => this.showScreen("question", "deny-state");
    },
    
    initEventListeners: function() {
        // 1. ë„¤/ì•„ë‹ˆì˜¤ ë²„íŠ¼
        UI.elements.yes_btn.addEventListener("click", () => {
            this.showScreen("portal", "access-state");
        });
        UI.elements.no_btn.addEventListener("click", () => {
            this.showDenyMessage();
        });
        
        // 2. ê¸‰ì‹ ë©”ë‰´ ë²„íŠ¼
        UI.elements.lunch_menu_btn.addEventListener("click", () => {
            this.showMealMenu("portal", "access-state");
        });
        
        // 3. ëŒì•„ê°€ê¸° ë²„íŠ¼ (ì´ˆê¸° ìƒíƒœì—ì„œëŠ” ì§ˆë¬¸ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ë„ë¡ ì„¤ì •)
        // ì‹¤ì œ ë™ì‘ì€ showMealMenu ë˜ëŠ” showDenyMessageì—ì„œ ìƒí™©ì— ë§ê²Œ ì¬ì„¤ì •ë©ë‹ˆë‹¤.
        UI.elements.back_btn.onclick = () => this.showScreen("question", "deny-state");
    }
};

// --- ì‹œìŠ¤í…œ ì´ˆê¸°í™” ---
StateManager.initEventListeners();
displayTodayDate(); 
</script>
</body>
</html>